{"componentChunkName":"component---src-templates-blog-post-js","path":"/my-new-new-tab-page/","result":{"data":{"site":{"siteMetadata":{"title":"I don't proof read."}},"markdownRemark":{"id":"347d2f5d-9bcd-59d7-b38c-49734015cd05","excerpt":"Yesterday I pushed an update to my small Chrome extension. The extension changes chrome://newtab to a different HTML page, with a (hopefully) beautiful image, a…","html":"<p>Yesterday I pushed an update to my small Chrome extension. The extension changes chrome://newtab to a different HTML page, with a (hopefully) beautiful image, a big clock, the current temperature and weather for the user’s location, and a selection of links to my most used websites.</p>\n<p>I’d always hated the default Chrome new tab page - the eight autogenerated links at the bottom of the page seemingly never went to the sites I wanted to go to, and most of the time their thumbnails were ugly or empty. To make it even worse, until <a href=\"https://thenextweb.com/google/2017/05/08/google-chrome-new-page-asymmetry-fixed\">it was fixed</a> the other day, the Google search bar was <a href=\"https://thenextweb.com/google/2017/05/03/google-chrome-new-tab-not-symmetrical/\">asymetrical</a> (not that anyone ever used that bar when the omnibox was autohighlighted anyway).</p>\n<p>So I decided to make a new new tab page. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/d52511f063458195677d3f08476787f3/3fe84/tab.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAGe3FejCYP/xAAaEAACAwEBAAAAAAAAAAAAAAABAgADBBEh/9oACAEBAAEFAs9oV7NXrWt0QiGf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAHBAAAQMFAAAAAAAAAAAAAAAAAAERMQISICGR/9oACAEBAAY/AnWG2W0dJw//xAAYEAEAAwEAAAAAAAAAAAAAAAABABExcf/aAAgBAQABPyEmiBdR7jmqayvs2QKuibn/2gAMAwEAAgADAAAAEN/v/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFxQf/aAAgBAQABPxDNOo2/D2Us12O+QbXLbhKC2S61P2oCmHJ//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Pretty\"\n        title=\"Pretty\"\n        src=\"/blog/static/d52511f063458195677d3f08476787f3/1c72d/tab.jpg\"\n        srcset=\"/blog/static/d52511f063458195677d3f08476787f3/a80bd/tab.jpg 148w,\n/blog/static/d52511f063458195677d3f08476787f3/1c91a/tab.jpg 295w,\n/blog/static/d52511f063458195677d3f08476787f3/1c72d/tab.jpg 590w,\n/blog/static/d52511f063458195677d3f08476787f3/a8a14/tab.jpg 885w,\n/blog/static/d52511f063458195677d3f08476787f3/fbd2c/tab.jpg 1180w,\n/blog/static/d52511f063458195677d3f08476787f3/3fe84/tab.jpg 1599w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>How it works</h2>\n<p>My extension pulls a random image from <a href=\"https://unsplash.com/\">Unsplash</a> and weather data from <a href=\"https://openweathermap.org/\">OpenWeatherMap</a>. Unfortunately, for an image to look good on modern high resolution displays, they need to be very big. I use an XPS 13 with a 3200x1800 resolution display so even 1920x1080 images don’t look quite sharp enough for me. Large images take time to download and display though, which is an issue. Initially, whenever the user opens a new tab an AJAX request was made to Unsplash and the random image download and set as the page background. The image would usually stutter and barely finish loading by the time the user had navigated away from the new tab page. With images that never finished loading I had essentially replaced my old new tab page with a plain black one.</p>\n<p>To get around this, I decided to cache an image when the user visited the new tab page, and then display the image that was cached when the user visits the new tab page the next time. This meant that all loading was done in the background and all displaying of images was done from locally stored images, so there was virtually no delay on the image being displayed. The logic worked like this -</p>\n<ol>\n<li>When the user opens a new tab page check if there’s an image cached</li>\n<li>If there is, get the cached image and display it</li>\n<li>If no image previously cached (could be the first time they visit the new tab page after installing the extension), then show a local backup image.</li>\n<li>After displaying an image, send an AJAX request to download a new image</li>\n<li>Get the image from the AJAX request and cache it for the next time the user opens a new tab page</li>\n</ol>\n<p>There were a few kinks with this plan, though - Chrome’s localStorage API only accepts saving strings, not images, so I’d have to convert my image to a base64 URL for saving. Fortunately, I have worked enough with the HTML5 Canvas element to know how to do this. Chrome’s localStorage API also seems to have a 5MB limit on it per origin. There is an unlimitedStorage permission that is meant to remove this cap, but it never seemed to work for me, and many sites cite a 10MB limit for Chrome normally, which again never worked for me. This storage limit was pretty minor though - while some images pulled from Unsplash could be larger than 5MB, especially after being converted to base64 (usually about 33% bigger than the original image), these were pretty rare, and if the image failed to save then the next time the user opens a new tab it would just show one of the equally pretty backup images.</p>\n<p>There was one other big problem with the above logic though, which I proudly fixed with the update I just pushed. </p>\n<p>Converting an image to base64, especially large images, takes a <em>long</em> time. Most of the time, the user would have navigated away from the new tab page before the image has a chance to be processed and cached, so in 90% of situations a backup image gets shown. This was fairly easy to fix, but required I take more advantage of the things Chrome extensions offer, namely, running in the background.</p>\n<p>The function to get, convert and save the images was moved to another script file which was allowed to run in the background. Then whenever a new tab was opened a message was passed from the main JavaScript file to call the image caching function. If the user moves away from the new tab page the function will continue running and (almost always) guarantee to cache an image, before going idle again until a new tab page is opened again.</p>\n<h2>To do</h2>\n<p>There’s still lots to work on if I ever want to think about publishing this extension though, I need -</p>\n<ul>\n<li>A settings page to let users change the links on it, and change things like Celcius to F, and 24 hour clock to 12 hour.</li>\n<li>A proper API key for Unsplash and OWM needs to be applied for, instead of using a developer one just for myself.</li>\n<li>The way the image is displayed in the HTML needs to be improved to better handle weirdly shaped images and vertical monitors.</li>\n<li>The image info sections needs a rewrite.</li>\n<li>Many more minor changes.</li>\n</ul>\n<p>If you want to try it out from my <a href=\"https://github.com/xRokco/New-Tab\">GitHub</a> - there’s installation instructions in the readme. Alternatively, you could help me think of a name for it. New new tab page isn’t a great one.</p>","frontmatter":{"title":"My New New Tab Page","date":"May 09, 2017","description":""}}},"pageContext":{"slug":"/my-new-new-tab-page/","previous":{"fields":{"slug":"/ive-an-exam-tomorrow/"},"frontmatter":{"title":"I have an exam tomorrow..."}},"next":{"fields":{"slug":"/general-update/"},"frontmatter":{"title":"General Matt Update"}}}}}